<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaginaInicio</title>
    <link rel="stylesheet" href="configU.css">
    <script src="./sentencias.js"></script>
</head>
<body>
    <div class="FondoPr">
        <nav>
            <div class="Buscador">
                <div class="logo">
                    <a href="./InicioSesionIniciada.html">
                        <img class="icono" src="./imagenes/icon.png">
                    </a>
                    <a href="./InicioSesionIniciada.html">
                        <label>FOXSHOP</label>
                    </a>  
                </div>
                <div class="search">
                    <div class="categorias">
                        <label>Categorias</label>
                        <img class="flecha" src="./imagenes/flecha.png">
                    </div>
                    <div class="buscar">
                        <input id="input1" type="text" placeholder="Buscar en foxshop.com">
                    </div>
                    <a href="busqueda.html">
                        <img class="lupa" src="./imagenes/lupa.jpg">
                    </a>
                </div>
                <input type="checkbox" class="hidden-checkbox">
                <div class="usuario">
                    <img class="user" src="./imagenes/user.png">
                    <label class="bienvenidoTexto">Bienvenido,</label>
                    <label id="nombreUsuario" class="nombreUsuario" for="menuCheckbox">name</label>
                    <input type="checkbox" id="menuCheckbox" class="hidden-checkbox">
                    <div class="desplegable">
                        <div class="menuOpciones">
                            <a href="configU.html">Configuracion</a>
                            <a href="./InicioSesion.html">Cerrar Sesion</a>
                        </div>
                    </div>
                </div>            
                <div class="compra">
                    <a href="carrito.html">
                        <img src="./imagenes/carrito.png">
                        <div class="texto">
                            <label>Carrito</label>
                    </a>
                    </div>
                </div>
            </div>
            <div class="Barra">
                <div class="tipos">
                    <div>
                        <a href="./InicioSesionIniciada.html">
                            <label>Inicio</label>
                        </a>
                    </div>
                    <div>
                        <label class="lomas">Lo mas vendido</label>
                        <img class="star" src="./imagenes/estrella.png">
                    </div>
                    <div>
                        <label>Promociones</label>
                    </div>
                    <div>
                        <label>Lo nuevo</label>
                    </div>
                    <div>
                        <label>Musica</label>
                    </div>
                    <div>
                        <label>Electronicos</label>
                    </div>
                </div>
            </div>
        </nav>

        <div class="Principal">

            <div class="recuadromorado">
                <div class="title">
                    <h1>Configuración del usuario</h1>
                </div>

                <div class="contentinputs">
                    <div>
                        <h3>Nombre</h3>
                        <input id="nombre" type="text" class="input-personalizado">
                    </div>
                    <div>
                        <h3>Apellidos</h3>
                        <input id="apellido" type="text" class="input-personalizado">
                    </div>
                    <div>
                        <h3>Correo electrónico</h3>
                        <input id="correo" type="text" class="input-personalizado">
                    </div>
                    <div>
                        <h3>Num.Teléfono</h3>
                        <input id="telefono" type="text" class="input-personalizado">
                    </div>
                    <div>
                        <h3>Contraseña actual</h3>
                        <input id="contraseña" type="text" class="input-personalizado">
                    </div>
                    <div>
                        <h3>Contraseña nueva</h3>
                        <input id="NuevaContra" type="text" class="input-personalizado">
                    </div>
                </div>
                
                <h3 class="title2">Dirección de envío</h3>
                
                <div class="txtarea">
                    <textarea id="direccion" class="textareamod" placeholder=""></textarea>
                </div>

                <div class="botones">
                    <a href="InicioSesionIniciada.html"><button class="boton-personalizado">Regresar</button></a>
                    <button id="botonActualizar" class="boton-personalizado2">Actualizar</button>
                </div>  
                
            </div>

        </div>


    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
    // Obtener el nombre de usuario del Local Storage
    const nombreUsuario = localStorage.getItem('nombreUsuario');
    const usuario = obtenerUsuarioPorNombre(nombreUsuario);

    // Asignar el nombre de usuario al label
    const labelNombreUsuario = document.getElementById('nombreUsuario');
    labelNombreUsuario.textContent = usuario.nombre;

    // Llenar los campos con la información del usuario
    asignarValor('nombre', usuario.nombre);
    asignarValor('apellido', usuario.apellido);
    asignarValor('correo', usuario.correo);
    asignarValor('telefono', usuario.telefono);
    asignarValor('direccion', usuario.direccion);
    asignarValor('contraseña', usuario.contra); // Mostrar contraseña actual es opcional
    asignarValor('NuevaContra', ''); // Mostrar nueva contraseña es opcional

    // Agregar evento al botón de "Actualizar"
    const botonActualizar = document.getElementById('botonActualizar');
    botonActualizar.addEventListener('click', actualizarInformacion);

    function obtenerUsuarioPorNombre(nombreUsuario) {
        const usuariosRegistrados = JSON.parse(localStorage.getItem('usuarios')) || [];
        return usuariosRegistrados.find(usuario => usuario && usuario.nombre === nombreUsuario);
    }

    function asignarValor(id, valor) {
        const elemento = document.getElementById(id);
        if (elemento) {
            elemento.value = valor;
        } else {
            console.error(`Elemento con ID '${id}' no encontrado.`);
        }
    }

    function actualizarInformacion() {
        // Obtener el índice del usuario en el array del Local Storage
        const correoNuevo = document.getElementById('correo').value;
        const usuariosRegistrados = JSON.parse(localStorage.getItem('usuarios')) || [];
        
        // Verificar si hay otro usuario con el mismo correo
        const usuarioExistente = usuariosRegistrados.find(usuario => usuario.correo === correoNuevo);
        if (usuarioExistente && usuarioExistente.nombre !== nombreUsuario) {
            alert('Ya hay un usuario registrado con este correo electrónico.');
            return;
        }

        const indexUsuario = usuariosRegistrados.findIndex(usuario => usuario.nombre === nombreUsuario);

        // Verificar si se encontró el usuario
        if (indexUsuario !== -1) {
            // Actualizar la información del usuario con los nuevos valores de los campos
            usuariosRegistrados[indexUsuario].nombre = document.getElementById('nombre').value;
            usuariosRegistrados[indexUsuario].apellido = document.getElementById('apellido').value;
            usuariosRegistrados[indexUsuario].correo = correoNuevo;
            usuariosRegistrados[indexUsuario].telefono = document.getElementById('telefono').value;
            usuariosRegistrados[indexUsuario].direccion = document.getElementById('direccion').value;
            usuariosRegistrados[indexUsuario].contra = document.getElementById('NuevaContra').value;
            // Puedes manejar las contraseñas según tus necesidades

            // Actualizar la información en el localStorage
            localStorage.setItem('usuarios', JSON.stringify(usuariosRegistrados));

            // Actualizar el nombre de usuario en el Local Storage
            localStorage.setItem('nombreUsuario', usuariosRegistrados[indexUsuario].nombre);

            // Redirigir a la página de inicio de sesión iniciada o hacer otras acciones necesarias
            window.location.href = './InicioSesionIniciada.html';
        } else {
            console.error('Usuario no encontrado');
        }
    }
});
    </script>
</body>
</html>